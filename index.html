<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mamata Yadav - Portfolio</title>

  <!-- Tailwind and font (keeps original look) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Poppins', sans-serif; }
    .gradient-bg { background: linear-gradient(135deg, #1e293b 0%, #7c3aed 50%, #1e293b 100%); }
    .card-hover { transition: all 0.3s ease; }
    .card-hover:hover { transform: translateY(-10px); }
    /* Modal scroll fix */
    .modal-scroll { max-height: 80vh; overflow:auto; }
    /* small helper */
    .invisible-a { position: absolute; left:-9999px; top:-9999px; }
  </style>
</head>
<body class="gradient-bg min-h-screen text-white">
  <div id="app"></div>

  <script>
  /************************************************************************
   * Full corrected portfolio page
   * - Keeps original visuals and structure you provided
   * - Uses IndexedDB for reliable storage (no "undefined .set" errors)
   * - All edit buttons/pencil icons work
   * - Supports image: URL or file upload (file -> dataURL). Warn about size.
   * - Publish to GitHub: saves portfolio_edits.json in your repo (prompts token each time)
   ************************************************************************/

  /* ========== CONFIG ========== */
  const ADMIN_PASSWORD = 'admin123';
  const DB_NAME = 'PortfolioDB_v2';
  const STORE = 'portfolio';
  // IMPORTANT: change these to your exact GitHub user/repo if you want publish ready
  const GITHUB_OWNER = 'mamatayadav1'; // your GitHub username (update if different)
  const GITHUB_REPO = 'Mamata_Yadav.github.io'; // your repo (update if different)

  /* ========== IndexedDB helpers ========== */
  function openDB() {
    return new Promise((resolve, reject) => {
      const req = indexedDB.open(DB_NAME, 1);
      req.onupgradeneeded = (e) => {
        const db = e.target.result;
        if (!db.objectStoreNames.contains(STORE)) db.createObjectStore(STORE);
      };
      req.onsuccess = (e) => resolve(e.target.result);
      req.onerror = (e) => reject(e.target.error);
    });
  }

  async function idbGet(key) {
    const db = await openDB();
    return new Promise((resolve, reject) => {
      const tx = db.transaction(STORE, 'readonly');
      const store = tx.objectStore(STORE);
      const r = store.get(key);
      r.onsuccess = () => resolve(r.result);
      r.onerror = () => reject(r.error);
    });
  }

  async function idbSet(key, value) {
    const db = await openDB();
    return new Promise((resolve, reject) => {
      const tx = db.transaction(STORE, 'readwrite');
      const store = tx.objectStore(STORE);
      const p = store.put(value, key);
      p.onsuccess = () => resolve(true);
      p.onerror = () => reject(p.error);
    });
  }

  async function idbGetAll() {
    const db = await openDB();
    return new Promise((resolve, reject) => {
      const tx = db.transaction(STORE, 'readonly');
      const store = tx.objectStore(STORE);
      const r = store.getAllKeys();
      r.onsuccess = () => resolve(r.result);
      r.onerror = () => reject(r.error);
    });
  }

  /* ========== Default data (preserve your original content) ========== */
  const defaultData = {
    home: {
      name: 'Mamata Yadav',
      title: 'Data Scientist & AI Developer',
      description: 'Passionate about transforming data into actionable insights and building intelligent systems.',
      email: 'mamata@example.com',
      linkedin: 'https://linkedin.com/in/mamatayadav',
      github: 'https://github.com/mamatayadav',
      education: ['Master in Data Science\\nUniversity | 2021-2023', 'Bachelor in CS\\nUniversity | 2017-2021'],
      experience: ['Data Scientist\\nCompany | 2023-Present', 'AI Intern\\nCompany | 2022-2023'],
      skills: ['Python, R, SQL', 'TensorFlow, PyTorch', 'Computer Vision, NLP'],
      image: '' // optional dataURL or URL
    },
    projects: [
      { id: 1, title: 'ML Project', category: 'Machine Learning', desc: 'Sample project description', skills: ['Python','Scikit-learn'], github: 'https://github.com', icon: 'üß†' }
    ],
    blogs: [
      { id:1, title:'Sample Blog', excerpt:'Blog excerpt here', content:'Full blog content here', date:'Jan 2025', icon:'üìù' }
    ]
  };

  /* ========== App state ========== */
  let state = null;    // saved object (loaded from IDB)
  let isEditMode = false;

  /* ========== Utility: load or init state ========== */
  async function loadState() {
    try {
      const saved = await idbGet('portfolio_data');
      state = saved ? saved : defaultData;
      // For backward compatibility: ensure arrays exist
      state.home = state.home || defaultData.home;
      state.projects = state.projects || defaultData.projects;
      state.blogs = state.blogs || defaultData.blogs;
      await idbSet('portfolio_data', state); // ensure it is stored
    } catch (err) {
      console.error('IDB load error, falling back to defaults', err);
      state = defaultData;
      try { await idbSet('portfolio_data', state); } catch(e){ console.error(e); }
    }
  }

  /* ========== Render (keeps your original markup & styles) ========== */
  function render() {
    const home = state.home;
    const projects = state.projects;
    const blogs = state.blogs;

    document.getElementById('app').innerHTML = `
      <nav class="fixed top-0 left-0 right-0 bg-slate-900/80 backdrop-blur-lg border-b border-purple-500/20 z-40">
        <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
          <h1 class="text-2xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">${escapeHtml(home.name)}</h1>
          <div class="flex gap-3 items-center">
            <button id="publishBtn" class="px-3 py-2 rounded-lg bg-emerald-600 text-white text-sm hidden">Publish</button>
            <button id="editModeToggle" class="px-4 py-2 rounded-lg font-semibold ${isEditMode ? 'bg-red-500' : 'bg-gradient-to-r from-purple-500 to-pink-500'}">${isEditMode ? 'Exit Edit' : 'Edit Mode'}</button>
          </div>
        </div>
      </nav>

      <section class="pt-32 pb-20 px-4">
        <div class="max-w-4xl mx-auto text-center">
          ${isEditMode ? '<button id="editHomeBtn" class="mb-4 px-4 py-2 bg-purple-500/20 border border-purple-500 rounded-lg">‚úèÔ∏è Edit Home</button>' : ''}
          <div class="w-48 h-48 mx-auto mb-8 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 p-1">
            <div class="w-full h-full rounded-full bg-slate-800 flex items-center justify-center text-6xl">
              ${home.image ? `<img src="${home.image}" alt="profile" class="w-full h-full object-cover rounded-full" />` : 'üë§'}
            </div>
          </div>

          <h2 class="text-5xl font-bold mb-4 bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">${escapeHtml(home.name)}</h2>
          <p class="text-2xl text-purple-300 mb-6">${escapeHtml(home.title)}</p>
          <p class="text-gray-300 text-lg mb-8 max-w-2xl mx-auto">${escapeHtml(home.description)}</p>

          <div class="flex justify-center gap-4 mb-12">
            <a href="mailto:${escapeAttr(home.email)}" class="p-3 bg-slate-800 rounded-full hover:bg-purple-500 transition-colors">üìß</a>
            <a href="${escapeAttr(home.linkedin)}" target="_blank" class="p-3 bg-slate-800 rounded-full hover:bg-purple-500 transition-colors">üíº</a>
            <a href="${escapeAttr(home.github)}" target="_blank" class="p-3 bg-slate-800 rounded-full hover:bg-purple-500 transition-colors">üíª</a>
          </div>

          <div class="grid md:grid-cols-3 gap-6 mt-12">
            <div class="bg-slate-800/50 p-6 rounded-xl border border-purple-500/20 relative">
              ${isEditMode ? '<button class="edit-edu absolute top-4 right-4 text-purple-400">‚úèÔ∏è</button>' : ''}
              <h3 class="text-xl font-semibold mb-4 text-purple-400">üéì Education</h3>
              ${home.education.map(e => `<div class="mb-3 text-gray-300">${e.replace('\\n','<br>')}</div>`).join('')}
            </div>

            <div class="bg-slate-800/50 p-6 rounded-xl border border-purple-500/20 relative">
              ${isEditMode ? '<button class="edit-exp absolute top-4 right-4 text-purple-400">‚úèÔ∏è</button>' : ''}
              <h3 class="text-xl font-semibold mb-4 text-purple-400">üíº Experience</h3>
              ${home.experience.map(e => `<div class="mb-3 text-gray-300">${e.replace('\\n','<br>')}</div>`).join('')}
            </div>

            <div class="bg-slate-800/50 p-6 rounded-xl border border-purple-500/20 relative">
              ${isEditMode ? '<button class="edit-skill absolute top-4 right-4 text-purple-400">‚úèÔ∏è</button>' : ''}
              <h3 class="text-xl font-semibold mb-4 text-purple-400">üíª Skills</h3>
              ${home.skills.map(s => `<div class="mb-3 text-gray-300">${escapeHtml(s)}</div>`).join('')}
            </div>
          </div>
        </div>
      </section>

      <section class="py-20 px-4 bg-slate-900/50">
        <div class="max-w-6xl mx-auto">
          <div class="flex justify-between items-center mb-12">
            <h2 class="text-4xl font-bold">My Projects</h2>
            ${isEditMode ? '<button id="addProjectBtn" class="px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg">‚ûï Add Project</button>' : ''}
          </div>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${projects.map(p => projectCardHTML(p, isEditMode)).join('')}
          </div>
        </div>
      </section>

      <section class="py-20 px-4">
        <div class="max-w-6xl mx-auto">
          <div class="flex justify-between items-center mb-12">
            <h2 class="text-4xl font-bold">Latest Blogs</h2>
            ${isEditMode ? '<button id="addBlogBtn" class="px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg">‚ûï Add Blog</button>' : ''}
          </div>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${blogs.map(b => blogCardHTML(b, isEditMode)).join('')}
          </div>
        </div>
      </section>

      <footer class="py-12 px-4 bg-slate-900/80 border-t border-purple-500/20 text-center">
        <div class="flex justify-center gap-4 mb-4">
          <a href="mailto:${escapeAttr(home.email)}" class="p-3 bg-slate-800 rounded-full hover:bg-purple-500 transition-colors">üìß</a>
          <a href="${escapeAttr(home.linkedin)}" target="_blank" class="p-3 bg-slate-800 rounded-full hover:bg-purple-500 transition-colors">üíº</a>
          <a href="${escapeAttr(home.github)}" target="_blank" class="p-3 bg-slate-800 rounded-full hover:bg-purple-500 transition-colors">üíª</a>
        </div>
        <p class="text-gray-400">&copy; 2025 ${escapeHtml(home.name)}. All rights reserved.</p>
      </footer>

      <div id="modal"></div>
    `;

    // wire up dynamic buttons (delegation)
    document.getElementById('editModeToggle').addEventListener('click', toggleEditMode);
    document.getElementById('publishBtn').addEventListener('click', publishToGitHub);

    if (isEditMode) {
      // pencil icons
      document.querySelectorAll('.edit-edu').forEach(btn => btn.addEventListener('click', openEditEducation));
      document.querySelectorAll('.edit-exp').forEach(btn => btn.addEventListener('click', openEditExperience));
      document.querySelectorAll('.edit-skill').forEach(btn => btn.addEventListener('click', openEditSkills));
      // project/blog add
      const addP = document.getElementById('addProjectBtn'); if (addP) addP.addEventListener('click', openAddProject);
      const addB = document.getElementById('addBlogBtn'); if (addB) addB.addEventListener('click', openAddBlog);
      // per project/blog edit/delete buttons - use delegation on container
      document.querySelectorAll('[data-action="proj-edit"]').forEach(btn=>{
        btn.addEventListener('click', (e)=> {
          const id = Number(e.currentTarget.dataset.id); openEditProject(id);
        });
      });
      document.querySelectorAll('[data-action="proj-delete"]').forEach(btn=>{
        btn.addEventListener('click', (e)=> {
          const id = Number(e.currentTarget.dataset.id); deleteProject(id);
        });
      });
      document.querySelectorAll('[data-action="blog-edit"]').forEach(btn=>{
        btn.addEventListener('click', (e)=> {
          const id = Number(e.currentTarget.dataset.id); openEditBlog(id);
        });
      });
      document.querySelectorAll('[data-action="blog-delete"]').forEach(btn=>{
        btn.addEventListener('click', (e)=> {
          const id = Number(e.currentTarget.dataset.id); deleteBlog(id);
        });
      });
    } else {
      // view blog when not editing
      document.querySelectorAll('[data-view="blog"]').forEach(btn=>{
        btn.addEventListener('click', (e)=> { const id = Number(e.currentTarget.dataset.id); viewBlog(id); });
      });
    }
  } // end render()

  /* ========== helpers - escape to avoid accidental HTML injection ========== */
  function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }
  function escapeAttr(s){ return encodeURI(String(s||'')); }

  function projectCardHTML(p, editMode) {
    return `
      <div class="bg-slate-800/50 rounded-xl overflow-hidden border border-purple-500/20 card-hover relative">
        ${editMode ? `<button data-action="proj-edit" data-id="${p.id}" class="absolute top-2 right-14 z-10 p-2 bg-slate-900/80 rounded-lg text-purple-400">‚úèÔ∏è</button>
                      <button data-action="proj-delete" data-id="${p.id}" class="absolute top-2 right-2 z-10 p-2 bg-slate-900/80 rounded-lg text-red-400">üóëÔ∏è</button>` : ''}
        <div class="h-48 bg-gradient-to-br from-purple-600 to-pink-600 flex items-center justify-center text-6xl">${p.icon}</div>
        <div class="p-6">
          <span class="text-xs px-3 py-1 bg-purple-500/20 text-purple-300 rounded-full">${escapeHtml(p.category)}</span>
          <h3 class="text-xl font-bold mt-3 mb-2">${escapeHtml(p.title)}</h3>
          <p class="text-gray-400 text-sm mb-4">${escapeHtml(p.desc)}</p>
          <div class="flex flex-wrap gap-2 mb-4">
            ${p.skills.map(s=>`<span class="text-xs px-2 py-1 bg-slate-700 rounded">${escapeHtml(s)}</span>`).join('')}
          </div>
          <a href="${escapeAttr(p.github)}" target="_blank" class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg">View Project</a>
        </div>
      </div>
    `;
  }

  function blogCardHTML(b, editMode) {
    return `
      <div class="bg-slate-800/50 rounded-xl overflow-hidden border border-purple-500/20 card-hover ${editMode ? 'relative':''}" ${!editMode ? `data-view="blog" data-id="${b.id}"` : ''}>
        ${editMode ? `<button data-action="blog-edit" data-id="${b.id}" class="absolute top-2 right-14 z-10 p-2 bg-slate-900/80 rounded-lg text-purple-400">‚úèÔ∏è</button>
                      <button data-action="blog-delete" data-id="${b.id}" class="absolute top-2 right-2 z-10 p-2 bg-slate-900/80 rounded-lg text-red-400">üóëÔ∏è</button>` : ''}
        <div class="h-48 bg-gradient-to-br from-purple-600 to-pink-600 flex items-center justify-center text-6xl">${b.icon}</div>
        <div class="p-6">
          <div class="flex justify-between text-xs text-gray-400 mb-3">
            <span>By: ${escapeHtml(state.home.name)}</span>
            <span>${escapeHtml(b.date)}</span>
          </div>
          <h3 class="text-xl font-bold mb-2">${escapeHtml(b.title)}</h3>
          <p class="text-gray-400 text-sm">${escapeHtml(b.excerpt)}</p>
        </div>
      </div>
    `;
  }

  /* ========== Actions: toggles, edit modals, save actions ========== */

  function toggleEditMode() {
    const pwd = isEditMode ? null : prompt('Enter password:');
    if (!isEditMode && pwd !== ADMIN_PASSWORD) {
      if (pwd) alert('‚ùå Incorrect password!');
      return;
    }
    isEditMode = !isEditMode;
    // show publish button only in edit mode
    const publishBtn = document.getElementById('publishBtn');
    if (publishBtn) publishBtn.classList.toggle('hidden', !isEditMode);
    render();
  }

  /* ---- Home edit modal (also supports image upload or URL) ---- */
  function openEditHome() {
    const h = state.home;
    const modal = document.getElementById('modal');
    modal.innerHTML = `
      <div class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
        <div class="bg-slate-800 rounded-2xl p-6 max-w-2xl w-full modal-scroll">
          <h2 class="text-2xl font-bold mb-4">Edit Home</h2>

          <label class="block mt-2">Name</label>
          <input id="f_name" class="w-full p-2 rounded" value="${escapeHtml(h.name)}"/>

          <label class="block mt-2">Title</label>
          <input id="f_title" class="w-full p-2 rounded" value="${escapeHtml(h.title)}"/>

          <label class="block mt-2">Description</label>
          <textarea id="f_desc" class="w-full p-2 rounded" rows="3">${escapeHtml(h.description)}</textarea>

          <label class="block mt-2">Email</label>
          <input id="f_email" class="w-full p-2 rounded" value="${escapeHtml(h.email)}"/>

          <label class="block mt-2">LinkedIn URL</label>
          <input id="f_link" class="w-full p-2 rounded" value="${escapeAttr(h.linkedin)}"/>

          <label class="block mt-2">GitHub URL</label>
          <input id="f_git" class="w-full p-2 rounded" value="${escapeAttr(h.github)}"/>

          <label class="block mt-2">Profile Image URL (preferred)</label>
          <input id="f_imgurl" class="w-full p-2 rounded" placeholder="https://..." value="${escapeAttr(h.image||'')}"/>

          <label class="block mt-2">Or Upload Image (converts to data URL ‚Äî may be large)</label>
          <input id="f_imgfile" type="file" accept="image/*" class="w-full p-2 rounded" />

          <div class="flex gap-3 mt-4 justify-end">
            <button onclick="closeModal()" class="px-4 py-2 rounded bg-slate-700">Cancel</button>
            <button onclick="saveHome()" class="px-4 py-2 rounded bg-gradient-to-r from-purple-500 to-pink-500">Save</button>
          </div>
        </div>
      </div>
    `;

    // attach file change handler
    const fileInput = document.getElementById('f_imgfile');
    fileInput.addEventListener('change', () => {
      const f = fileInput.files[0];
      if (!f) return;
      if (f.size > 2 * 1024*1024) { // 2MB warning
        if (!confirm('File is larger than 2MB ‚Äî this may fill browser storage. Continue?')) return;
      }
      const reader = new FileReader();
      reader.onload = (e) => {
        document.getElementById('f_imgurl').value = e.target.result; // put data URL in URL box
      };
      reader.readAsDataURL(f);
    });
  }
  window.openEditHome = openEditHome; // make global for buttons

  async function saveHome() {
    const h = state.home;
    h.name = document.getElementById('f_name').value.trim();
    h.title = document.getElementById('f_title').value.trim();
    h.description = document.getElementById('f_desc').value.trim();
    h.email = document.getElementById('f_email').value.trim();
    h.linkedin = document.getElementById('f_link').value.trim();
    h.github = document.getElementById('f_git').value.trim();
    const imgv = document.getElementById('f_imgurl').value.trim();
    if (imgv) h.image = imgv;
    try {
      await idbSet('portfolio_data', state);
      alert('‚úÖ Home saved');
      closeModal();
      render();
    } catch (err) { alert('Save error: '+err.message); console.error(err); }
  }
  window.saveHome = saveHome;

  /* ---- Education / Experience / Skills modals ---- */
  function openEditEducation() {
    const modal = document.getElementById('modal');
    modal.innerHTML = `
      <div class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
        <div class="bg-slate-800 rounded-2xl p-6 max-w-2xl w-full modal-scroll">
          <h2 class="text-2xl font-bold mb-4">Edit Education (separate entries by blank line)</h2>
          <textarea id="f_edu" rows="10" class="w-full p-2 rounded">${(state.home.education||[]).join('\\n\\n')}</textarea>
          <div class="flex gap-3 mt-4 justify-end">
            <button onclick="closeModal()" class="px-4 py-2 rounded bg-slate-700">Cancel</button>
            <button onclick="saveEducation()" class="px-4 py-2 rounded bg-gradient-to-r from-purple-500 to-pink-500">Save</button>
          </div>
        </div>
      </div>
    `;
  }
  window.openEditEducation = openEditEducation;

  async function saveEducation() {
    const v = document.getElementById('f_edu').value.split(/\n\s*\n/).map(s=>s.trim()).filter(Boolean);
    state.home.education = v;
    await idbSet('portfolio_data', state);
    alert('‚úÖ Education saved');
    closeModal(); render();
  }
  window.saveEducation = saveEducation;

  function openEditExperience() {
    const modal = document.getElementById('modal');
    modal.innerHTML = `
      <div class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
        <div class="bg-slate-800 rounded-2xl p-6 max-w-2xl w-full modal-scroll">
          <h2 class="text-2xl font-bold mb-4">Edit Experience (separate entries by blank line)</h2>
          <textarea id="f_exp" rows="10" class="w-full p-2 rounded">${(state.home.experience||[]).join('\\n\\n')}</textarea>
          <div class="flex gap-3 mt-4 justify-end">
            <button onclick="closeModal()" class="px-4 py-2 rounded bg-slate-700">Cancel</button>
            <button onclick="saveExperience()" class="px-4 py-2 rounded bg-gradient-to-r from-purple-500 to-pink-500">Save</button>
          </div>
        </div>
      </div>
    `;
  }
  window.openEditExperience = openEditExperience;

  async function saveExperience() {
    const v = document.getElementById('f_exp').value.split(/\n\s*\n/).map(s=>s.trim()).filter(Boolean);
    state.home.experience = v;
    await idbSet('portfolio_data', state);
    alert('‚úÖ Experience saved');
    closeModal(); render();
  }
  window.saveExperience = saveExperience;

  function openEditSkills() {
    const modal = document.getElementById('modal');
    modal.innerHTML = `
      <div class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
        <div class="bg-slate-800 rounded-2xl p-6 max-w-2xl w-full modal-scroll">
          <h2 class="text-2xl font-bold mb-4">Edit Skills (one per line)</h2>
          <textarea id="f_skills" rows="8" class="w-full p-2 rounded">${(state.home.skills||[]).join('\\n')}</textarea>
          <div class="flex gap-3 mt-4 justify-end">
            <button onclick="closeModal()" class="px-4 py-2 rounded bg-slate-700">Cancel</button>
            <button onclick="saveSkills()" class="px-4 py-2 rounded bg-gradient-to-r from-purple-500 to-pink-500">Save</button>
          </div>
        </div>
      </div>
    `;
  }
  window.openEditSkills = openEditSkills;

  async function saveSkills() {
    const v = document.getElementById('f_skills').value.split(/\n/).map(s=>s.trim()).filter(Boolean);
    state.home.skills = v;
    await idbSet('portfolio_data', state);
    alert('‚úÖ Skills saved');
    closeModal(); render();
  }
  window.saveSkills = saveSkills;

  /* ---- Projects CRUD ---- */
  function openAddProject() {
    openProjectModal();
  }
  window.openAddProject = openAddProject;

  function openProjectModal(project=null) {
    const modal = document.getElementById('modal');
    const p = project || { id: Date.now(), title:'', category:'', desc:'', skills:[], github:'', icon:'üß†' };
    modal.innerHTML = `
      <div class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
        <div class="bg-slate-800 rounded-2xl p-6 max-w-2xl w-full modal-scroll">
          <h2 class="text-2xl font-bold mb-4">${project ? 'Edit' : 'Add'} Project</h2>
          <label>Title</label><input id="proj_title" class="w-full p-2 rounded" value="${escapeHtml(p.title)}"/>
          <label class="mt-2">Category</label><input id="proj_cat" class="w-full p-2 rounded" value="${escapeHtml(p.category)}"/>
          <label class="mt-2">Description</label><textarea id="proj_desc" class="w-full p-2 rounded" rows=4>${escapeHtml(p.desc)}</textarea>
          <label class="mt-2">Skills (comma separated)</label><input id="proj_sk" class="w-full p-2 rounded" value="${(p.skills||[]).join(', ')}"/>
          <label class="mt-2">GitHub URL</label><input id="proj_git" class="w-full p-2 rounded" value="${escapeAttr(p.github)}"/>
          <label class="mt-2">Icon (emoji)</label><input id="proj_icon" class="w-full p-2 rounded" value="${escapeHtml(p.icon)}"/>
          <div class="flex gap-3 mt-4 justify-end">
            <button onclick="closeModal()" class="px-4 py-2 rounded bg-slate-700">Cancel</button>
            <button onclick="saveProject(${p.id})" class="px-4 py-2 rounded bg-gradient-to-r from-purple-500 to-pink-500">Save</button>
          </div>
        </div>
      </div>`;
  }
  window.openProjectModal = openProjectModal;

  async function saveProject(id) {
    const title = document.getElementById('proj_title').value.trim();
    if (!title) { alert('Title required'); return; }
    const cat = document.getElementById('proj_cat').value.trim();
    const desc = document.getElementById('proj_desc').value.trim();
    const skills = document.getElementById('proj_sk').value.split(',').map(s=>s.trim()).filter(Boolean);
    const git = document.getElementById('proj_git').value.trim();
    const icon = document.getElementById('proj_icon').value.trim() || 'üß†';

    const idx = state.projects.findIndex(p => p.id === id);
    const obj = { id, title, category:cat, desc, skills, github:git, icon };
    if (idx >= 0) state.projects[idx] = obj; else state.projects.push(obj);

    await idbSet('portfolio_data', state);
    alert('‚úÖ Project saved');
    closeModal(); render();
  }
  window.saveProject = saveProject;

  function openEditProject(id) {
    const p = state.projects.find(x=>x.id===id);
    if (!p) return alert('Project not found');
    openProjectModal(p);
  }
  window.openEditProject = openEditProject;

  async function deleteProject(id) {
    if (!confirm('Delete this project?')) return;
    state.projects = state.projects.filter(x=>x.id!==id);
    await idbSet('portfolio_data', state);
    alert('‚úÖ Project deleted');
    render();
  }
  window.deleteProject = deleteProject;

  /* ---- Blogs CRUD ---- */
  function openAddBlog() { openBlogModal(); }
  window.openAddBlog = openAddBlog;

  function openBlogModal(blog=null) {
    const b = blog || { id: Date.now(), title:'', excerpt:'', content:'', date:'', icon:'üìù' };
    const modal = document.getElementById('modal');
    modal.innerHTML = `
      <div class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
        <div class="bg-slate-800 rounded-2xl p-6 max-w-2xl w-full modal-scroll">
          <h2 class="text-2xl font-bold mb-4">${blog ? 'Edit' : 'Add'} Blog</h2>
          <label>Title</label><input id="blog_title" class="w-full p-2 rounded" value="${escapeHtml(b.title)}"/>
          <label class="mt-2">Excerpt</label><textarea id="blog_excerpt" class="w-full p-2 rounded" rows=3>${escapeHtml(b.excerpt)}</textarea>
          <label class="mt-2">Full Content</label><textarea id="blog_content" class="w-full p-2 rounded" rows=6>${escapeHtml(b.content)}</textarea>
          <label class="mt-2">Date (e.g. Jan 2025)</label><input id="blog_date" class="w-full p-2 rounded" value="${escapeHtml(b.date)}"/>
          <label class="mt-2">Icon (emoji)</label><input id="blog_icon" class="w-full p-2 rounded" value="${escapeHtml(b.icon)}"/>
          <div class="flex gap-3 mt-4 justify-end">
            <button onclick="closeModal()" class="px-4 py-2 rounded bg-slate-700">Cancel</button>
            <button onclick="saveBlog(${b.id})" class="px-4 py-2 rounded bg-gradient-to-r from-purple-500 to-pink-500">Save</button>
          </div>
        </div>
      </div>
    `;
  }
  window.openBlogModal = openBlogModal;

  async function saveBlog(id) {
    const title = document.getElementById('blog_title').value.trim();
    if (!title) { alert('Title required'); return; }
    const excerpt = document.getElementById('blog_excerpt').value.trim();
    const content = document.getElementById('blog_content').value.trim();
    const date = document.getElementById('blog_date').value.trim();
    const icon = document.getElementById('blog_icon').value.trim()||'üìù';
    const idx = state.blogs.findIndex(b=>b.id===id);
    const obj = { id, title, excerpt, content, date, icon };
    if (idx>=0) state.blogs[idx]=obj; else state.blogs.push(obj);
    await idbSet('portfolio_data', state);
    alert('‚úÖ Blog saved');
    closeModal(); render();
  }
  window.saveBlog = saveBlog;

  async function openEditBlog(id) { const b=state.blogs.find(x=>x.id===id); if(!b) return alert('Not found'); openBlogModal(b); }
  window.openEditBlog = openEditBlog;

  async function deleteBlog(id) { if(!confirm('Delete this blog?')) return; state.blogs=state.blogs.filter(x=>x.id!==id); await idbSet('portfolio_data',state); alert('‚úÖ Blog deleted'); render(); }
  window.deleteBlog = deleteBlog;

  /* ---- Blog view (read mode) ---- */
  function viewBlog(id) {
    const b = state.blogs.find(x=>x.id===id);
    if(!b) return;
    const modal = document.getElementById('modal');
    modal.innerHTML = `
      <div class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
        <div class="bg-slate-800 rounded-2xl p-6 max-w-3xl w-full modal-scroll">
          <h2 class="text-2xl font-bold mb-2">${escapeHtml(b.title)}</h2>
          <div class="text-gray-400 text-sm mb-4">${escapeHtml(b.date)} ‚Ä¢ By ${escapeHtml(state.home.name)}</div>
          <div class="prose text-gray-200 whitespace-pre-wrap">${escapeHtml(b.content)}</div>
          <div class="flex gap-3 mt-6 justify-end">
            <button onclick="closeModal()" class="px-4 py-2 rounded bg-slate-700">Close</button>
          </div>
        </div>
      </div>
    `;
  }
  window.viewBlog = viewBlog;

  function closeModal() { document.getElementById('modal').innerHTML = ''; }

  /* ========== Publish to GitHub (saves portfolio_edits.json) ========== */
  async function publishToGitHub() {
    try {
      // ask for token (session only)
      const token = prompt('Paste your GitHub personal access token (it will NOT be stored).');
      if (!token) return alert('Publish cancelled.');

      // gather data (state)
      const contentObj = state;
      const contentStr = JSON.stringify(contentObj, null, 2);
      const contentBase64 = btoa(unescape(encodeURIComponent(contentStr)));

      const url = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/portfolio_edits.json`;

      // get existing file to obtain sha if exists
      const getResp = await fetch(url, { headers: { Authorization: `token ${token}` }});
      let sha = null;
      if (getResp.ok) {
        const info = await getResp.json();
        sha = info.sha;
      }

      const putResp = await fetch(url, {
        method: 'PUT',
        headers: { Authorization: `token ${token}`, 'Content-Type':'application/json' },
        body: JSON.stringify({
          message: `Update portfolio edits (${new Date().toISOString()})`,
          content: contentBase64,
          sha: sha || undefined
        })
      });

      if (putResp.ok) {
        alert('üéâ Published to GitHub as portfolio_edits.json');
      } else {
        const err = await putResp.json().catch(()=>({message:'Unknown error'}));
        alert('Publish failed: ' + (err.message || JSON.stringify(err)));
        console.error('Publish error', err);
      }
    } catch (err) {
      console.error('Publish exception', err);
      alert('Publish error: ' + err.message);
    }
  }
  window.publishToGitHub = publishToGitHub;

  /* ========== Startup ========== */
  async function start() {
    await loadState();
    // Attach global functions to window for inline use (if any)
    window.openEditHome = openEditHome;
    window.openEditEducation = openEditEducation;
    window.openEditExperience = openEditExperience;
    window.openEditSkills = openEditSkills;
    window.openProjectModal = openProjectModal;
    window.openBlogModal = openBlogModal;

    render();
  }

  start();

  // Expose closeModal globally
  window.closeModal = closeModal;
  // Expose toggleEditMode for nav button
  window.toggleEditMode = function(){ toggleEditMode(); };

  </script>
</body>
</html>
