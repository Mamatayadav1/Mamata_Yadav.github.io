<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mamata Yadav | Portfolio</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(120deg, #e4d9ff, #f9f9ff);
    color: #333;
    margin: 0;
    padding: 20px;
  }
  h1 {
    text-align: center;
    color: #5a2d82;
  }
  .section {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    padding: 20px;
    margin: 20px 0;
  }
  textarea {
    width: 100%;
    height: 120px;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 10px;
    font-size: 15px;
    resize: vertical;
  }
  button {
    background-color: #5a2d82;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 8px 14px;
    margin-top: 8px;
    cursor: pointer;
    transition: 0.2s;
  }
  button:hover {
    background-color: #4b2470;
  }
  #publishBtn {
    background-color: #6d3bb8;
    display: block;
    margin: 30px auto;
    padding: 10px 20px;
    font-size: 16px;
  }
  .msg {
    text-align: center;
    font-weight: 600;
    color: green;
  }
</style>
</head>
<body>

<h1>Mamata Yadav | Portfolio</h1>

<div id="sections"></div>
<button id="publishBtn">📤 Publish to GitHub</button>
<div id="status" class="msg"></div>

<script>
// --- CONFIG ---
const SECTIONS = ["Home", "Contact", "Education", "Experience", "Skills", "Projects", "Blogs"];
const DB_NAME = "portfolioDB";
const STORE_NAME = "sections";
const REPO_OWNER = "MamataYadav"; // your GitHub username
const REPO_NAME = "mamata-yadav.github.io"; // your portfolio repo name

// --- IndexedDB setup ---
function openDB() {
  return new Promise((resolve, reject) => {
    const req = indexedDB.open(DB_NAME, 1);
    req.onupgradeneeded = e => e.target.result.createObjectStore(STORE_NAME);
    req.onsuccess = e => resolve(e.target.result);
    req.onerror = e => reject(e);
  });
}

function saveSection(name, data) {
  return openDB().then(db => {
    const tx = db.transaction(STORE_NAME, "readwrite");
    tx.objectStore(STORE_NAME).put(LZString.compressToUTF16(data), name);
    return tx.complete;
  });
}

function loadSection(name) {
  return openDB().then(db => {
    return new Promise(resolve => {
      const tx = db.transaction(STORE_NAME, "readonly");
      const req = tx.objectStore(STORE_NAME).get(name);
      req.onsuccess = () => resolve(LZString.decompressFromUTF16(req.result || ""));
    });
  });
}

// --- UI creation ---
async function createSections() {
  const container = document.getElementById("sections");
  for (const sec of SECTIONS) {
    const div = document.createElement("div");
    div.className = "section";
    div.innerHTML = `<h2>${sec}</h2>
      <textarea id="txt-${sec}"></textarea><br>
      <button onclick="save('${sec}')">💾 Save</button>`;
    container.appendChild(div);
    const data = await loadSection(sec);
    if (data) document.getElementById(`txt-${sec}`).value = data;
  }
}

async function save(section) {
  const val = document.getElementById(`txt-${section}`).value;
  await saveSection(section, val);
  showStatus(`✅ Saved ${section}`);
}

// --- Publish to GitHub ---
async function publishToGitHub() {
  const token = prompt("Enter your GitHub Personal Access Token (not stored):");
  if (!token) return showStatus("❌ Publish cancelled");

  const data = {};
  for (const sec of SECTIONS) {
    data[sec] = document.getElementById(`txt-${sec}`).value;
  }

  const content = btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2))));
  const url = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/portfolio_edits.json`;

  const getResp = await fetch(url, {
    headers: { Authorization: `token ${token}` }
  });
  const fileInfo = getResp.ok ? await getResp.json() : {};
  const sha = fileInfo.sha || null;

  const putResp = await fetch(url, {
    method: "PUT",
    headers: {
      "Authorization": `token ${token}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      message: "Update portfolio edits",
      content,
      sha
    })
  });

  if (putResp.ok) showStatus("🎉 Successfully published to GitHub!");
  else showStatus("⚠️ Publish failed — check token or repo name.");
}

function showStatus(msg) {
  document.getElementById("status").innerText = msg;
  setTimeout(() => document.getElementById("status").innerText = "", 5000);
}

// --- Compression Library (LZString, minimal build) ---
const LZString=function(){function o(o,r){if(!t[o]){t[o]={};for(var n=0;n<o.length;n++)t[o][o.charAt(n)]=n}return t[o][r]}var r=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",t={},e={compressToUTF16:function(o){if(null==o)return"";var t,e,i,s={},p={},u="",a="",c="",l=2,f=3,h=2,d=[],m=0,v=0;for(i=0;i<o.length;i+=1)if(u=o.charAt(i),Object.prototype.hasOwnProperty.call(s,u)||(s[u]=f++,p[u]=!0),a=c+u,Object.prototype.hasOwnProperty.call(s,a))c=a;else{if(Object.prototype.hasOwnProperty.call(p,c)){if(c.charCodeAt(0)<256){for(t=0;t<h;t++)m<<=1,v==15?(v=0,d.push(r(m)),m=0):v++;for(e=c.charCodeAt(0),t=0;t<8;t++)m=m<<1|1&e,v==15?(v=0,d.push(r(m)),m=0):v++,e>>=1}else{for(e=1,t=0;t<h;t++)m=m<<1|e,v==15?(v=0,d.push(r(m)),m=0):v++,e=0;for(e=c.charCodeAt(0),t=0;t<16;t++)m=m<<1|1&e,v==15?(v=0,d.push(r(m)),m=0):v++,e>>=1}h++,delete p[c]}else for(e=s[c],t=0;t<h;t++)m=m<<1|1&e,v==15?(v=0,d.push(r(m)),m=0):v++,e>>=1;--h,0==--f&&(h++),s[a]=f++,c=String.fromCharCode(e)}if(""!==c){if(Object.prototype.hasOwnProperty.call(p,c)){if(c.charCodeAt(0)<256){for(t=0;t<h;t++)m<<=1,v==15?(v=0,d.push(r(m)),m=0):v++;for(e=c.charCodeAt(0),t=0;t<8;t++)m=m<<1|1&e,v==15?(v=0,d.push(r(m)),m=0):v++,e>>=1}else{for(e=1,t=0;t<h;t++)m=m<<1|e,v==15?(v=0,d.push(r(m)),m=0):v++,e=0;for(e=c.charCodeAt(0),t=0;t<16;t++)m=m<<1|1&e,v==15?(v=0,d.push(r(m)),m=0):v++,e>>=1}h++,delete p[c]}else for(e=s[c],t=0;t<h;t++)m=m<<1|1&e,v==15?(v=0,d.push(r(m)),m=0):v++,e>>=1}for(;m;)m<<=1,v==15?(v=0,d.push(r(m)),m=0):v++;return d.push(r(m)),d.join("")},decompressFromUTF16:function(o){if(null==o)return"";for(var t,n,e,i,s,p,u,a="",c=0,l=0,f=0,h=[],d=0;d<o.length;d++){if(f=(o.charCodeAt(d)-32)&65535,0==c?(c=15,t=f):(t=f<<c|t,n+=16,c-=16),c<0&&(c=0));for(;c>=8;)n|=(t&255)<<c-8,h.push(String.fromCharCode(t&255)),t>>=8,c-=8;if(d==o.length-1&&c>0){for(;c>0;)n|=(t&255)<<c-8,h.push(String.fromCharCode(t&255)),t>>=8,c-=8}}return decodeURIComponent(escape(h.join("")))}};
return e;}();

// --- Start ---
createSections();
document.getElementById("publishBtn").addEventListener("click", publishToGitHub);
</script>

</body>
</html>
