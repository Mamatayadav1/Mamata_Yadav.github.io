<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mamata Yadav - Data Scientist & AI Developer</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #a78bfa; --secondary: #818cf8; --accent: #c084fc;
            --text: #e5e7eb; --dark-bg: #0f172a; --card-bg: rgba(30, 41, 59, 0.7);
            --glass-bg: rgba(30, 41, 59, 0.4); --shadow: rgba(167, 139, 250, 0.3);
        }
        body { font-family: 'Poppins', sans-serif; color: var(--text); background: #0a0e1a; overflow-x: hidden; }
        .animated-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }
        .gradient-orb { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.6; animation: float 20s infinite ease-in-out; }
        .orb1 { width: 500px; height: 500px; background: radial-gradient(circle, rgba(167, 139, 250, 0.4), transparent); top: -200px; left: -200px; }
        .orb2 { width: 400px; height: 400px; background: radial-gradient(circle, rgba(129, 140, 248, 0.3), transparent); bottom: -150px; right: -150px; animation-delay: 7s; }
        .orb3 { width: 350px; height: 350px; background: radial-gradient(circle, rgba(192, 132, 252, 0.35), transparent); top: 50%; right: 10%; animation-delay: 14s; }
        @keyframes float { 0%, 100% { transform: translate(0, 0) scale(1); } 33% { transform: translate(100px, -100px) scale(1.1); } 66% { transform: translate(-50px, 100px) scale(0.9); } }
        .particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        .particle { position: absolute; width: 4px; height: 4px; background: rgba(167, 139, 250, 0.8); border-radius: 50%; box-shadow: 0 0 10px rgba(167, 139, 250, 0.5); animation: twinkle 2s infinite alternate; }
        @keyframes twinkle { 0% { opacity: 0.3; } 100% { opacity: 1; } }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; position: relative; z-index: 2; }
        nav { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); width: calc(100% - 40px); max-width: 1200px; background: rgba(30, 41, 59, 0.3); backdrop-filter: blur(20px); border: 1px solid rgba(167, 139, 250, 0.2); border-radius: 20px; z-index: 1000; padding: 15px 30px; }
        nav .nav-container { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        .logo { font-size: 1.5rem; font-weight: 700; background: linear-gradient(135deg, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nav-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn { padding: 10px 20px; border-radius: 25px; border: none; cursor: pointer; font-weight: 600; font-family: 'Poppins', sans-serif; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; }
        .btn-secondary { background: rgba(30, 41, 59, 0.5); color: var(--primary); border: 1px solid var(--primary); }
        .btn-success { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .btn-danger { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px var(--shadow); }
        section { min-height: 100vh; display: flex; align-items: center; padding: 120px 0 80px; position: relative; }
        .hero { text-align: center; }
        .profile-img-container { position: relative; width: 220px; margin: 0 auto 30px; }
        .profile-img { width: 220px; height: 220px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--accent)); display: flex; align-items: center; justify-content: center; font-size: 5rem; color: white; animation: profileFloat 4s ease-in-out infinite; border: 4px solid rgba(167, 139, 250, 0.3); overflow: hidden; position: relative; }
        @keyframes profileFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        .profile-img img { width: 100%; height: 100%; object-fit: cover; }
        .upload-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; border-radius: 50%; cursor: pointer; }
        .edit-mode .upload-overlay { display: flex; }
        .editable { position: relative; cursor: text; }
        .edit-mode .editable:hover { outline: 2px dashed var(--primary); outline-offset: 4px; }
        .editable[contenteditable="true"] { outline: 2px solid var(--accent); outline-offset: 4px; }
        h1 { font-size: 3.5rem; margin-bottom: 10px; background: linear-gradient(135deg, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .subtitle { font-size: 1.6rem; color: var(--accent); margin-bottom: 20px; }
        .description { font-size: 1.1rem; margin-bottom: 30px; opacity: 0.9; max-width: 700px; margin-left: auto; margin-right: auto; }
        .social-links { display: flex; gap: 20px; justify-content: center; margin-top: 30px; }
        .social-links a { width: 55px; height: 55px; border-radius: 50%; background: var(--glass-bg); display: flex; align-items: center; justify-content: center; color: var(--primary); font-size: 1.3rem; transition: all 0.4s ease; border: 1px solid rgba(167, 139, 250, 0.2); }
        .social-links a:hover { transform: translateY(-10px); background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; }
        .info-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-top: 60px; }
        .card { background: var(--glass-bg); backdrop-filter: blur(20px); padding: 35px; border-radius: 25px; border: 1px solid rgba(167, 139, 250, 0.2); transition: all 0.4s ease; position: relative; }
        .card:hover { transform: translateY(-15px); border-color: rgba(167, 139, 250, 0.5); }
        .card h3 { color: var(--primary); margin-bottom: 20px; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
        .card-item { margin-bottom: 15px; padding-left: 20px; position: relative; }
        .card-item::before { content: '→'; position: absolute; left: 0; color: var(--primary); }
        .section-title { text-align: center; font-size: 3rem; margin-bottom: 60px; background: linear-gradient(135deg, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .projects-grid, .blogs-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 35px; }
        .project-card, .blog-card { background: var(--glass-bg); backdrop-filter: blur(20px); border-radius: 25px; overflow: hidden; border: 1px solid rgba(167, 139, 250, 0.2); transition: all 0.4s ease; position: relative; }
        .project-card:hover, .blog-card:hover { transform: translateY(-20px); border-color: rgba(167, 139, 250, 0.6); }
        .project-img, .blog-img { width: 100%; height: 220px; background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; color: white; font-size: 3.5rem; position: relative; overflow: hidden; }
        .project-img img, .blog-img img { width: 100%; height: 100%; object-fit: cover; }
        .project-content, .blog-content { padding: 28px; }
        .project-category { display: inline-block; padding: 6px 16px; background: rgba(167, 139, 250, 0.2); color: var(--primary); border-radius: 20px; font-size: 0.85rem; margin-bottom: 12px; }
        .project-title, .blog-title { font-size: 1.4rem; margin-bottom: 12px; color: var(--accent); }
        .project-skills { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 18px; }
        .skill-tag { padding: 6px 14px; background: linear-gradient(135deg, rgba(167, 139, 250, 0.3), rgba(129, 140, 248, 0.3)); color: white; border-radius: 20px; font-size: 0.85rem; }
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); padding: 20px; overflow-y: auto; }
        .modal.active { display: flex; justify-content: center; align-items: center; }
        .modal-content { background: var(--card-bg); padding: 40px; border-radius: 25px; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; border: 1px solid rgba(167, 139, 250, 0.3); }
        .modal-content h2 { color: var(--primary); margin-bottom: 25px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: var(--text); }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid rgba(167, 139, 250, 0.3); background: rgba(15, 23, 42, 0.5); color: var(--text); font-family: 'Poppins', sans-serif; font-size: 1rem; }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .form-actions { display: flex; gap: 12px; justify-content: flex-end; margin-top: 30px; flex-wrap: wrap; }
        footer { background: var(--glass-bg); padding: 50px 0; text-align: center; border-top: 1px solid rgba(167, 139, 250, 0.2); position: relative; z-index: 2; }
        .add-item-btn { position: absolute; top: 10px; right: 10px; background: var(--primary); color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; display: none; font-family: 'Poppins', sans-serif; font-size: 0.9rem; }
        .edit-mode .add-item-btn { display: block; }
        .status-bar { position: fixed; bottom: 20px; right: 20px; background: var(--glass-bg); backdrop-filter: blur(20px); padding: 15px 25px; border-radius: 15px; border: 1px solid rgba(167, 139, 250, 0.3); display: none; z-index: 1000; }
        .status-bar.show { display: block; }
        .auto-save-indicator { color: #10b981; font-size: 0.9rem; }
        @media (max-width: 768px) { 
            h1 { font-size: 2.5rem; } 
            .info-cards, .projects-grid, .blogs-grid { grid-template-columns: 1fr; }
            .nav-container { flex-direction: column; align-items: stretch; }
            .nav-buttons { justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="animated-bg">
        <div class="gradient-orb orb1"></div>
        <div class="gradient-orb orb2"></div>
        <div class="gradient-orb orb3"></div>
    </div>
    <div class="particles" id="particles"></div>

    <input type="file" id="imageUpload" accept="image/*" style="display: none;">

    <div class="modal" id="passwordModal">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <h2><i class="fas fa-lock"></i> Admin Access</h2>
            <p style="margin: 15px 0;">Enter password</p>
            <input type="password" id="adminPassword" style="margin: 20px 0; text-align: center;" placeholder="Enter password" onkeypress="if(event.key==='Enter') verifyPassword()">
            <p id="passwordError" style="color: #ef4444; display: none; margin-top: 10px;">Incorrect password!</p>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closePasswordModal()">Cancel</button>
                <button class="btn btn-primary" onclick="verifyPassword()"><i class="fas fa-unlock"></i> Unlock</button>
            </div>
        </div>
    </div>

    <div class="modal" id="githubModal">
        <div class="modal-content" style="max-width: 500px;">
            <h2><i class="fab fa-github"></i> Publish to GitHub</h2>
            <p style="margin-bottom: 20px; opacity: 0.9;">Enter your GitHub details to publish changes globally</p>
            <div class="form-group">
                <label>GitHub Username</label>
                <input type="text" id="githubUsername" placeholder="your-username">
            </div>
            <div class="form-group">
                <label>Repository Name</label>
                <input type="text" id="githubRepo" placeholder="portfolio">
            </div>
            <div class="form-group">
                <label>Personal Access Token (<a href="https://github.com/settings/tokens" target="_blank" style="color: var(--accent);">Create one</a>)</label>
                <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx">
                <small style="opacity: 0.7; display: block; margin-top: 5px;">Token is NOT saved. Only used for this session.</small>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeGithubModal()">Cancel</button>
                <button class="btn btn-success" onclick="publishToGithub()"><i class="fas fa-cloud-upload-alt"></i> Publish Now</button>
            </div>
        </div>
    </div>

    <div class="modal" id="addItemModal">
        <div class="modal-content">
            <h2 id="addItemTitle">Add Item</h2>
            <form id="addItemForm" onsubmit="saveNewItem(event)">
                <div class="form-group">
                    <label>Content</label>
                    <textarea id="itemContent" required placeholder="Enter content"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddItemModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Add</button>
                </div>
            </form>
        </div>
    </div>

    <nav>
        <div class="nav-container">
            <div class="logo editable" id="logoText" data-field="name">Mamata Yadav</div>
            <div class="nav-buttons">
                <button class="btn btn-primary" id="editModeBtn" onclick="requestEditMode()"><i class="fas fa-edit"></i> Edit Mode</button>
                <button class="btn btn-success" id="publishBtn" style="display: none;" onclick="openGithubModal()"><i class="fab fa-github"></i> Publish</button>
            </div>
        </div>
    </nav>

    <section id="home" class="hero">
        <div class="container">
            <div class="profile-img-container">
                <div class="profile-img" id="profileImg">
                    <i class="fas fa-user"></i>
                </div>
                <div class="upload-overlay" onclick="document.getElementById('imageUpload').click()">
                    <i class="fas fa-camera" style="font-size: 2rem;"></i>
                </div>
            </div>
            <h1 class="editable" id="heroName" data-field="name">Mamata Yadav</h1>
            <p class="subtitle editable" id="heroTitle" data-field="title">Data Scientist & AI Developer</p>
            <p class="description editable" id="heroDesc" data-field="desc">Passionate about transforming data into actionable insights and building intelligent systems that solve real-world problems.</p>
            <div class="social-links" id="heroSocial"></div>
            <div class="info-cards" id="infoCards"></div>
        </div>
    </section>

    <section id="projects">
        <div class="container">
            <h2 class="section-title">My Projects</h2>
            <div class="projects-grid" id="projectsGrid"></div>
        </div>
    </section>

    <section id="blogs">
        <div class="container">
            <h2 class="section-title">Latest Blogs</h2>
            <div class="blogs-grid" id="blogsGrid"></div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="social-links" id="footerSocial" style="margin-bottom: 20px;"></div>
            <p>&copy; 2025 <span class="editable" id="footerName" data-field="name">Mamata Yadav</span>. All rights reserved.</p>
        </div>
    </footer>

    <div class="status-bar" id="statusBar">
        <div class="auto-save-indicator">
            <i class="fas fa-check-circle"></i> <span id="statusText">Auto-saved</span>
        </div>
    </div>

    <script>
        const PASS = '240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9';
        let isEditMode = false;
        let db;
        let currentSection = '';
        let currentCardIndex = -1;
        let autoSaveTimeout;

        const defaultData = {
            name: 'Mamata Yadav',
            title: 'Data Scientist & AI Developer',
            desc: 'Passionate about transforming data into actionable insights and building intelligent systems that solve real-world problems.',
            profileImage: '',
            email: 'mamata@example.com',
            linkedin: 'https://linkedin.com/in/mamatayadav',
            github: 'https://github.com/mamatayadav',
            education: [
                'Masters in Data Science\nStanford University | 2021-2023',
                'Bachelor in Computer Science\nMIT | 2017-2021'
            ],
            experience: [
                'Senior Data Scientist\nGoogle | 2023-Present',
                'Data Analyst\nMicrosoft | 2021-2023'
            ],
            skills: [
                'Python, R, SQL',
                'Machine Learning, Deep Learning',
                'TensorFlow, PyTorch, Scikit-learn'
            ],
            projects: [{
                id: 1,
                title: 'AI-Powered Recommendation System',
                category: 'Machine Learning',
                desc: 'Built a personalized recommendation engine using collaborative filtering and deep learning techniques.',
                skills: ['Python', 'TensorFlow', 'Neural Networks'],
                github: 'https://github.com',
                image: ''
            }],
            blogs: [{
                id: 1,
                title: 'Understanding Deep Learning: A Beginner\'s Guide',
                excerpt: 'An introduction to neural networks and how they power modern AI applications.',
                content: 'Deep learning has revolutionized artificial intelligence. In this guide, we explore neural networks, backpropagation, and building your first model.',
                date: 'Jan 2025',
                image: ''
            }]
        };

        let portfolioData = JSON.parse(JSON.stringify(defaultData));

        // Initialize IndexedDB
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('PortfolioDB', 1);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
                
                request.onupgradeneeded = (e) => {
                    const database = e.target.result;
                    if (!database.objectStoreNames.contains('portfolio')) {
                        database.createObjectStore('portfolio', { keyPath: 'id' });
                    }
                    if (!database.objectStoreNames.contains('images')) {
                        database.createObjectStore('images', { keyPath: 'id' });
                    }
                };
            });
        }

        // Compress data before saving
        function compressData(data) {
            const jsonStr = JSON.stringify(data);
            const compressed = pako.deflate(jsonStr, { to: 'string' });
            return btoa(compressed);
        }

        // Decompress data after loading
        function decompressData(compressed) {
            try {
                const decoded = atob(compressed);
                const decompressed = pako.inflate(decoded, { to: 'string' });
                return JSON.parse(decompressed);
            } catch (e) {
                return null;
            }
        }

        // Save to IndexedDB
        async function saveToIndexedDB(data) {
            return new Promise((resolve, reject) => {
                const compressed = compressData(data);
                const transaction = db.transaction(['portfolio'], 'readwrite');
                const store = transaction.objectStore('portfolio');
                const request = store.put({ id: 'main', data: compressed });
                
                request.onsuccess = () => {
                    showStatus('Auto-saved locally');
                    resolve();
                };
                request.onerror = () => reject(request.error);
            });
        }

        // Load from IndexedDB
        async function loadFromIndexedDB() {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['portfolio'], 'readonly');
                const store = transaction.objectStore('portfolio');
                const request = store.get('main');
                
                request.onsuccess = () => {
                    if (request.result) {
                        const data = decompressData(request.result.data);
                        if (data) {
                            portfolioData = data;
                        }
                    }
                    resolve();
                };
                request.onerror = () => resolve(); // Continue with defaults
            });
        }

        // Save image to IndexedDB
        async function saveImageToIndexedDB(id, dataUrl) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['images'], 'readwrite');
                const store = transaction.objectStore('images');
                const request = store.put({ id, data: dataUrl });
                
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        // Load image from IndexedDB
        async function loadImageFromIndexedDB(id) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['images'], 'readonly');
                const store = transaction.objectStore('images');
                const request = store.get(id);
                
                request.onsuccess = () => {
                    resolve(request.result ? request.result.data : null);
                };
                request.onerror = () => resolve(null);
            });
        }

        // Auto-save with debounce
        function triggerAutoSave() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(async () => {
                await saveToIndexedDB(portfolioData);
            }, 1000);
        }

        // Show status message
        function showStatus(message) {
            const statusBar = document.getElementById('statusBar');
            const statusText = document.getElementById('statusText');
            statusText.textContent = message;
            statusBar.classList.add('show');
            setTimeout(() => statusBar.classList.remove('show'), 3000);
        }

        // Hash password
        async function hashPassword(p) {
            const b = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(p));
            return Array.from(new Uint8Array(b)).map(x => x.toString(16).padStart(2, '0')).join('');
        }

        // Password modal
        function requestEditMode() {
            if (isEditMode) {
                exitEditMode();
            } else {
                document.getElementById('passwordModal').classList.add('active');
                document.getElementById('adminPassword').value = '';
                document.getElementById('passwordError').style.display = 'none';
            }
        }

        function closePasswordModal() {
            document.getElementById('passwordModal').classList.remove('active');
        }

        async function verifyPassword() {
            const h = await hashPassword(document.getElementById('adminPassword').value);
            if (h === PASS) {
                closePasswordModal();
                enableEditMode();
            } else {
                document.getElementById('passwordError').style.display = 'block';
            }
        }

        function enableEditMode() {
            isEditMode = true;
            document.body.classList.add('edit-mode');
            document.getElementById('editModeBtn').innerHTML = '<i class="fas fa-times"></i> Exit Edit';
            document.getElementById('editModeBtn').classList.remove('btn-primary');
            document.getElementById('editModeBtn').classList.add('btn-danger');
            document.getElementById('publishBtn').style.display = 'inline-flex';
            
            // Make text elements editable
            document.querySelectorAll('.editable').forEach(el => {
                el.contentEditable = true;
                el.addEventListener('blur', handleEditableBlur);
                el.addEventListener('input', triggerAutoSave);
            });
            
            showStatus('Edit mode enabled');
        }

        function exitEditMode() {
            isEditMode = false;
            document.body.classList.remove('edit-mode');
            document.getElementById('editModeBtn').innerHTML = '<i class="fas fa-edit"></i> Edit Mode';
            document.getElementById('editModeBtn').classList.remove('btn-danger');
            document.getElementById('editModeBtn').classList.add('btn-primary');
            document.getElementById('publishBtn').style.display = 'none';
            
            // Disable editing
            document.querySelectorAll('.editable').forEach(el => {
                el.contentEditable = false;
                el.removeEventListener('blur', handleEditableBlur);
                el.removeEventListener('input', triggerAutoSave);
            });
            
            showStatus('Edit mode disabled');
        }

        function handleEditableBlur(e) {
            const field = e.target.dataset.field;
            const value = e.target.textContent.trim();
            
            if (field && portfolioData[field] !== undefined) {
                portfolioData[field] = value;
                triggerAutoSave();
                
                // Update all instances
                document.querySelectorAll(`[data-field="${field}"]`).forEach(el => {
                    if (el !== e.target) {
                        el.textContent = value;
                    }
                });
            }
        }

        // Image upload
        document.getElementById('imageUpload').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = async (event) => {
                const dataUrl = event.target.result;
                
                // Save to IndexedDB
                await saveImageToIndexedDB('profile', dataUrl);
                portfolioData.profileImage = 'profile';
                
                // Update display
                document.getElementById('profileImg').innerHTML = `<img src="${dataUrl}" alt="Profile">`;
                
                triggerAutoSave();
                showStatus('Profile image uploaded');
            };
            reader.readAsDataURL(file);
        });

        // Render portfolio
        async function render() {
            // Load profile image
            if (portfolioData.profileImage) {
                const imgData = await loadImageFromIndexedDB(portfolioData.profileImage);
                if (imgData) {
                    document.getElementById('profileImg').innerHTML = `<img src="${imgData}" alt="Profile">`;
                }
            }
            
            // Update text content
            document.getElementById('logoText').textContent = portfolioData.name;
            document.getElementById('heroName').textContent = portfolioData.name;
            document.getElementById('heroTitle').textContent = portfolioData.title;
            document.getElementById('heroDesc').textContent = portfolioData.desc;
            document.getElementById('footerName').textContent = portfolioData.name;
            
            // Social links
            const social = `
                <a href="mailto:${portfolioData.email}" title="Email"><i class="fas fa-envelope"></i></a>
                <a href="${portfolioData.linkedin}" target="_blank" title="LinkedIn"><i class="fab fa-linkedin"></i></a>
                <a href="${portfolioData.github}" target="_blank" title="GitHub"><i class="fab fa-github"></i></a>
            `;
            document.getElementById('heroSocial').innerHTML = social;
            document.getElementById('footerSocial').innerHTML = social;
            
            // Info cards with add buttons
            document.getElementById('infoCards').innerHTML = `
                <div class="card">
                    <h3><i class="fas fa-graduation-cap"></i> Education</h3>
                    <button class="add-item-btn" onclick="openAddItem('education')"><i class="fas fa-plus"></i> Add</button>
                    <div id="educationList">
                        ${portfolioData.education.map((e, i) => `
                            <div class="card-item editable" data-section="education" data-index="${i}" contenteditable="false">
                                ${e.replace(/\n/g, '<br>')}
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="card">
                    <h3><i class="fas fa-briefcase"></i> Experience</h3>
                    <button class="add-item-btn" onclick="openAddItem('experience')"><i class="fas fa-plus"></i> Add</button>
                    <div id="experienceList">
                        ${portfolioData.experience.map((e, i) => `
                            <div class="card-item editable" data-section="experience" data-index="${i}" contenteditable="false">
                                ${e.replace(/\n/g, '<br>')}
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="card">
                    <h3><i class="fas fa-code"></i> Skills</h3>
                    <button class="add-item-btn" onclick="openAddItem('skills')"><i class="fas fa-plus"></i> Add</button>
                    <div id="skillsList">
                        ${portfolioData.skills.map((s, i) => `
                            <div class="card-item editable" data-section="skills" data-index="${i}" contenteditable="false">
                                ${s}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // Projects
            document.getElementById('projectsGrid').innerHTML = portfolioData.projects.map((p, i) => `
                <div class="project-card" data-id="${p.id}">
                    <div class="project-img" onclick="uploadProjectImage(${p.id})">
                        ${p.image ? `<img src="${p.image}" alt="${p.title}">` : '<i class="fas fa-brain"></i>'}
                    </div>
                    <div class="project-content">
                        <span class="project-category editable" data-section="projects" data-index="${i}" data-field="category" contenteditable="false">${p.category}</span>
                        <h3 class="project-title editable" data-section="projects" data-index="${i}" data-field="title" contenteditable="false">${p.title}</h3>
                        <p class="editable" data-section="projects" data-index="${i}" data-field="desc" contenteditable="false">${p.desc}</p>
                        <div class="project-skills">
                            ${p.skills.map(s => `<span class="skill-tag">${s}</span>`).join('')}
                        </div>
                        <a href="${p.github}" class="btn btn-primary" target="_blank"><i class="fab fa-github"></i> View on GitHub</a>
                    </div>
                </div>
            `).join('');
            
            // Blogs
            document.getElementById('blogsGrid').innerHTML = portfolioData.blogs.map((b, i) => `
                <div class="blog-card" data-id="${b.id}">
                    <div class="blog-img" onclick="uploadBlogImage(${b.id})">
                        ${b.image ? `<img src="${b.image}" alt="${b.title}">` : '<i class="fas fa-blog"></i>'}
                    </div>
                    <div class="blog-content">
                        <h3 class="blog-title editable" data-section="blogs" data-index="${i}" data-field="title" contenteditable="false">${b.title}</h3>
                        <p class="editable" data-section="blogs" data-index="${i}" data-field="excerpt" contenteditable="false">${b.excerpt}</p>
                        <p style="opacity: 0.7; font-size: 0.9rem; margin-top: 10px;"><i class="far fa-calendar"></i> ${b.date}</p>
                    </div>
                </div>
            `).join('');
            
            // Re-attach editable listeners if in edit mode
            if (isEditMode) {
                attachEditableListeners();
            }
        }

        function attachEditableListeners() {
            document.querySelectorAll('.editable[data-section]').forEach(el => {
                el.contentEditable = true;
                el.addEventListener('blur', handleArrayItemBlur);
                el.addEventListener('input', triggerAutoSave);
            });
        }

        function handleArrayItemBlur(e) {
            const section = e.target.dataset.section;
            const index = parseInt(e.target.dataset.index);
            const field = e.target.dataset.field;
            const value = e.target.innerHTML.replace(/<br>/g, '\n').replace(/<[^>]*>/g, '').trim();
            
            if (field) {
                // Update specific field in array item
                portfolioData[section][index][field] = value;
            } else {
                // Update entire array item
                portfolioData[section][index] = value;
            }
            
            triggerAutoSave();
        }

        // Add item modal
        function openAddItem(section) {
            currentSection = section;
            document.getElementById('addItemTitle').textContent = `Add ${section.slice(0, -1).charAt(0).toUpperCase() + section.slice(1, -1)}`;
            document.getElementById('itemContent').value = '';
            document.getElementById('addItemModal').classList.add('active');
        }

        function closeAddItemModal() {
            document.getElementById('addItemModal').classList.remove('active');
        }

        async function saveNewItem(e) {
            e.preventDefault();
            const content = document.getElementById('itemContent').value.trim();
            
            if (content && currentSection) {
                portfolioData[currentSection].push(content);
                await saveToIndexedDB(portfolioData);
                render();
                closeAddItemModal();
                showStatus('Item added successfully');
            }
        }

        // Upload project image
        function uploadProjectImage(id) {
            if (!isEditMode) return;
            
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = async (event) => {
                    const dataUrl = event.target.result;
                    const imageId = `project_${id}`;
                    
                    await saveImageToIndexedDB(imageId, dataUrl);
                    
                    const project = portfolioData.projects.find(p => p.id === id);
                    if (project) {
                        project.image = dataUrl;
                        await saveToIndexedDB(portfolioData);
                        render();
                        showStatus('Project image uploaded');
                    }
                };
                reader.readAsDataURL(file);
            };
            input.click();
        }

        // Upload blog image
        function uploadBlogImage(id) {
            if (!isEditMode) return;
            
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = async (event) => {
                    const dataUrl = event.target.result;
                    const imageId = `blog_${id}`;
                    
                    await saveImageToIndexedDB(imageId, dataUrl);
                    
                    const blog = portfolioData.blogs.find(b => b.id === id);
                    if (blog) {
                        blog.image = dataUrl;
                        await saveToIndexedDB(portfolioData);
                        render();
                        showStatus('Blog image uploaded');
                    }
                };
                reader.readAsDataURL(file);
            };
            input.click();
        }

        // GitHub publishing
        function openGithubModal() {
            document.getElementById('githubModal').classList.add('active');
        }

        function closeGithubModal() {
            document.getElementById('githubModal').classList.remove('active');
        }

        async function publishToGithub() {
            const username = document.getElementById('githubUsername').value.trim();
            const repo = document.getElementById('githubRepo').value.trim();
            const token = document.getElementById('githubToken').value.trim();
            
            if (!username || !repo || !token) {
                alert('Please fill all fields');
                return;
            }
            
            showStatus('Publishing to GitHub...');
            
            try {
                // Generate HTML content
                const htmlContent = await generateHTMLExport();
                
                // Encode to base64
                const encodedContent = btoa(unescape(encodeURIComponent(htmlContent)));
                
                // GitHub API endpoint
                const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/index.html`;
                
                // Get current file SHA (if exists)
                let sha = null;
                try {
                    const getResponse = await fetch(apiUrl, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    if (getResponse.ok) {
                        const data = await getResponse.json();
                        sha = data.sha;
                    }
                } catch (e) {
                    // File doesn't exist, will create new
                }
                
                // Push to GitHub
                const pushResponse = await fetch(apiUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Update portfolio via web editor',
                        content: encodedContent,
                        sha: sha
                    })
                });
                
                if (pushResponse.ok) {
                    closeGithubModal();
                    showStatus('✅ Published to GitHub successfully!');
                    alert(`✅ Portfolio published!\n\nView at: https://${username}.github.io/${repo}/`);
                } else {
                    const error = await pushResponse.json();
                    throw new Error(error.message || 'Failed to publish');
                }
            } catch (error) {
                showStatus('❌ Publishing failed');
                alert('Publishing failed: ' + error.message);
            }
        }

        async function generateHTMLExport() {
            // Get current HTML
            const html = document.documentElement.outerHTML;
            
            // Replace profile image with embedded data
            let exportHTML = html;
            
            if (portfolioData.profileImage) {
                const imgData = await loadImageFromIndexedDB(portfolioData.profileImage);
                if (imgData) {
                    exportHTML = exportHTML.replace(
                        /<div class="profile-img"[^>]*>.*?<\/div>/s,
                        `<div class="profile-img"><img src="${imgData}" alt="Profile"></div>`
                    );
                }
            }
            
            // Embed all project and blog images
            for (const project of portfolioData.projects) {
                if (project.image) {
                    const regex = new RegExp(`<div class="project-card" data-id="${project.id}">.*?<\/div>`, 's');
                    // Images are already data URLs in the HTML
                }
            }
            
            return exportHTML;
        }

        // Create particles
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(particle);
            }
        }

        // Close modals on outside click
        window.onclick = function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        }

        // Initialize
        async function init() {
            try {
                await initDB();
                await loadFromIndexedDB();
                render();
                createParticles();
                showStatus('Portfolio loaded');
            } catch (error) {
                console.error('Initialization error:', error);
                render();
                createParticles();
            }
        }

        init();
    </script>
</body>
</html>
